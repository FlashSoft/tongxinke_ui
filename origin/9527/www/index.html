<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>udx710</title>
  <link rel="stylesheet" href="./layui/css/layui.css" />
  <link rel="stylesheet" href="./index.css" />
  <script src="./layui/layui.js"></script>
  <script src="./index.js"></script>
</head>

<body>
  <!-- Sidebar Toggle Buttons -->
  <button class="sidebar-toggle mobile-only" id="mobileSidebarToggle">
    <i class="layui-icon layui-icon-menu-fill"></i>
  </button>
  <button class="sidebar-toggle desktop-only" id="desktopSidebarToggle">
    <i class="layui-icon layui-icon-shrink-right"></i>
  </button>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <ul class="layui-nav layui-nav-tree" lay-filter="sidebar-nav">
      <li class="layui-nav-item layui-this" data-tab-id="66"><a href="javascript:;">状态信息</a></li>
      <li class="layui-nav-item" data-tab-id="00"><a href="javascript:;">发短信</a></li>
      <li class="layui-nav-item" data-tab-id="11"><a href="javascript:;">收件箱</a></li>
      <li class="layui-nav-item" data-tab-id="22"><a href="javascript:;">短信转发</a></li>
      <li class="layui-nav-item" data-tab-id="33"><a href="javascript:;">温度信息</a></li>
      <li class="layui-nav-item" data-tab-id="44" id="bat_li_sidebar"><a href="javascript:;">电池信息</a></li>
      <li class="layui-nav-item" data-tab-id="55" style="display: none;"><a href="javascript:;">AT命令</a></li>
      <li class="layui-nav-item" data-tab-id="77"><a href="javascript:;">基带调试</a></li>
      <li class="layui-nav-item" data-tab-id="timereboot"><a href="javascript:;">定时重启</a></li>
      <li class="layui-nav-item" data-tab-id="tfc"><a href="javascript:;">流量控制</a></li>
      <li class="layui-nav-item" data-tab-id="usbmode"><a href="javascript:;">USB模式</a></li>
      <li class="layui-nav-item" data-tab-id="clash"><a href="javascript:;">Clash</a></li>
      <li class="layui-nav-item" data-tab-id="clashui"><a href="javascript:;">Clash面板</a></li>
      <li class="layui-nav-item" data-tab-id="terminal"><a href="javascript:;">网页终端</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="layui-tab" lay-filter="test-hash">
      <ul class="layui-tab-title">
        <li class="layui-this" lay-id="66">状态信息</li>
        <li lay-id="00">发短信</li>
        <li lay-id="11">收件箱</li>
        <li lay-id="22">短信转发</li>
        <li lay-id="33">温度信息</li>
        <li lay-id="44" id="bat_li">电池信息</li>
        <li lay-id="55">AT命令</li>
        <li lay-id="77">基带调试</li>
        <li lay-id="timereboot">定时重启</li>
        <li lay-id="tfc">流量控制</li>
        <li lay-id="usbmode">USB模式</li>
        <li lay-id="clash">Clash</li>
        <li lay-id="clashui">Clash面板</li>
        <li lay-id="terminal">网页终端</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show" id="sysinfo">
        </div>
        
        <div class="layui-tab-item">
          <div style="margin-bottom: 10px">
            <label for="ToNumInput">收件人：</label>
            <br /><br />
            <input id="ToNumInput" type="text" class="layui-input"
              style="width: 280px; display: inline-block; margin-right: 10px" />
            <button id="sendSMSBtn" class="layui-btn">发送</button>
          </div>
          <div>
            <label for="Text_Content">发送内容：</label>
            <br /><br />
            <textarea id="Text_Content" class="layui-textarea" style="width: 100%; height: 300px"></textarea>
          </div>
        </div>

        <div class="layui-tab-item">
          <button class="layui-btn layui-btn-danger" id="deleteSelected">
            删除
          </button>
          <button class="layui-btn layui-btn-danger" id="delete_SMS_DB">
            清空
          </button>
          <button class="layui-btn" id="refreshData">刷新</button>

          <br /><br />
          <div id="smsInfo" style="margin-bottom: 10px">
            <span id="smsCount">条数: 0</span>
            <span id="totalPages" style="margin-left: 20px">页数: 0</span>
            <span id="itemsPerPage" style="margin-left: 20px">每页: 0</span>
          </div>
          <table id="smsTable" class="layui-table"></table>
          <hr />
          <div id="paginationContainer" style="margin-top: 10px; display: flex; align-items: center">
            <button id="prevPage" class="layui-btn" style="margin-right: 10px" disabled>
              上一页
            </button>
            <button id="nextPage" class="layui-btn">下一页</button>
            <select id="pageSelect" class="layui-select" style="width: 80px; margin-left: 10px"></select>
            <select id="limitSelect" lay-filter="limitSelect" class="layui-select" style="width: 80px; margin-left: 10px">
              <option value="10">10条/页</option>
              <option value="25">25条/页</option>
              <option value="50">50条/页</option>
              <option value="100">100条/页</option>
            </select>
          </div>
        </div>

        <div class="layui-tab-item">
          <form class="layui-form" id="configForm">
            <div class="layui-form-item">
              <label class="layui-form-label">PushPlus</label>
              <div class="layui-input-block">
                <input type="checkbox" name="pushplus_forward" lay-skin="switch" lay-text="ON|OFF"
                  id="pushplus_forward" />
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">转发令牌</label>
              <div class="layui-input-block">
                <input type="text" name="pushplus_token" id="pushplus_token" placeholder="请输入32位数字字母组合的token令牌"
                  class="layui-input" maxlength="32" />
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">转发渠道</label>
              <div class="layui-input-block">
                <select name="pushplus_channel" id="pushplus_channel">
                  <option value="wechat">wechat</option>
                  <option value="mail">mail</option>
                  <option value="webhook">webhook</option>
                </select>
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">渠道编码</label>
              <div class="layui-input-block">
                <input type="text" name="pushplus_channel_code" id="pushplus_channel_code"
                  placeholder="选择webhook渠道时需要输入渠道编码" class="layui-input" maxlength="10" />
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">短信转发</label>
              <div class="layui-input-block">
                <input type="checkbox" name="sms_forward" lay-skin="switch" lay-text="ON|OFF" id="sms_forward" />
              </div>
            </div>

            <div class="layui-form-item">
              <label class="layui-form-label">转发号码</label>
              <div class="layui-input-block">
                <input type="text" name="to_num" id="to_num" placeholder="输入收信人手机号" class="layui-input" maxlength="20" />
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="saveConfig">
                  保存配置
                </button>
                <button type="button" class="layui-btn" id="deleteLogsButton">
                  删除日志
                </button>
              </div>
            </div>
          </form>
          <div class="layui-form-item" style="margin-top: 20px">
            <label class="layui-form-label">转发日志</label>
            <div class="layui-input-block">
              <textarea id="logTextarea" class="layui-textarea" placeholder="日志信息..." readonly
                style="height: 280px"></textarea>
            </div>
          </div>
        </div>
        <div class="layui-tab-item">
          <table id="tempTable" class="layui-table">
            <colgroup>
              <col style="width: 50%" />
              <col style="width: 50%" />
            </colgroup>
            <thead>
              <tr>
                <th>类型</th>
                <th>温度</th>
              </tr>
            </thead>
            <tbody id="tempTableBody"></tbody>
          </table>
        </div>
        <div class="layui-tab-item">
          <form class="layui-form" id="chargeForm">
            <h3>充电控制</h3>
            <hr />
            <div class="layui-form-item">
              <label class="layui-form-label" style="width: 100px; margin-right: 20px">充电状态</label>

              <input type="checkbox" lay-filter="charge_stop" name="charge_stop" id="charge_stop" title="ON|OFF"
                lay-skin="switch" />
            </div>
          </form>

          <h3>电池信息</h3>
          <hr />
          <table id="batteryTable" class="layui-table">
            <colgroup>
              <col style="width: 50%" />
              <col style="width: 50%" />
            </colgroup>
            <thead>
              <tr>
                <th>类型</th>
                <th>状态</th>
              </tr>
            </thead>
            <tbody id="batteryTableBody"></tbody>
          </table>
        </div>
        <div class="layui-tab-item">
          <div style="margin-bottom: 10px">
            <div>
              <label for="atCommandInput">AT命令：</label>
              
            </div>
            <br>
            <div style="display: flex; align-items: center">
              
              <input id="atCommandInput" type="text" class="layui-input" lay-affix="clear"
                style="width: 280px; display: inline-block; margin-right: 10px" />
              <button id="sendAtCommandBtn" class="layui-btn" style="margin-right: 0px">
                发送
              </button>
              <button id="other_atcmd" class="layui-btn" style="margin-right: 0px">
                常用命令
              </button>
            </div>
          </div>
          <div>
            <label for="atCommandResponse">响应内容：</label>
            <br /><br />
            <textarea id="atCommandResponse" class="layui-textarea" style="width: 100%; height: 450px"
              readonly></textarea>
          </div>
        </div>
        
        <div class="layui-tab-item">
            <iframe id="otherweb" src="" width="100%" height="2000px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
        <div class="layui-tab-item" id="timereboot_tab">
            <iframe id="timerebootweb" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
        <div class="layui-tab-item" id="tfc_tab">
            <iframe id="tfcweb" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
              <div class="layui-tab-item" id="usbmode_tab">
            <iframe id="usbmodeweb" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
              <div class="layui-tab-item" id="clash_tab">
            <iframe id="clashweb" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
              <div class="layui-tab-item" id="clashui_tab">
            <iframe id="clashui" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
        <div class="layui-tab-item" id="terminal_tab">
          <iframe id="terminalweb" src="" width="100%" height="800px" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" frameborder="0"></iframe>
        </div>
      </div>
    </div>
  </div>
</body>
<script>
// Hide the AT command tab and terminal tab in both the original tabs and sidebar
document.querySelector('li[lay-id="55"]').style.display = 'none';
document.querySelector('.sidebar .layui-nav-item[data-tab-id="55"]').style.display = 'none';
//document.querySelector('li[lay-id="terminal"]').style.display = 'none';
//document.querySelector('.sidebar .layui-nav-item[data-tab-id="terminal"]').style.display = 'none';

const currentIp = window.location.hostname;
const url_8080 = `http://${currentIp}:8080`;
const url_9998 = `http://${currentIp}:9998`;
const url_clashui = `http://${currentIp}:9999/ui`;
const url_51887 = `http://${currentIp}:51887`;
const url_51886 = `http://${currentIp}:51886`;
const url_51888 = `http://${currentIp}:51888`;
const url_7681 = `http://${currentIp}:7681`;

document.getElementById("otherweb").src = url_8080;
document.getElementById("clashweb").src = url_9998;
document.getElementById("clashui").src = url_clashui;
document.getElementById("tfcweb").src = url_51886;
document.getElementById("usbmodeweb").src = url_51887;
document.getElementById("timerebootweb").src = url_51888;
document.getElementById("terminalweb").src = url_7681;

// Function to check if device is mobile
function isMobile() {
  return window.innerWidth < 768;
}

// Function to update sidebar state based on device type
function updateSidebarState() {
  const sidebar = document.getElementById('sidebar');
  const mainContent = document.querySelector('.main-content');
  
  if (isMobile()) {
    // Mobile behavior - sidebar closed by default, overlays content when open
    sidebar.classList.remove('open');
    mainContent.classList.remove('pushed');
  } else {
    // Desktop behavior - sidebar open by default, content pushed
    sidebar.classList.add('open');
    mainContent.classList.add('pushed');
    
    // Update desktop toggle button position and icon
    updateDesktopToggleButton(true); // true means sidebar is open
  }
}

// Function to update desktop toggle button based on sidebar state
function updateDesktopToggleButton(isOpen) {
  const desktopToggleBtn = document.getElementById('desktopSidebarToggle');
  if (!desktopToggleBtn) return;
  
  if (isOpen) {
    desktopToggleBtn.style.left = '260px';
    desktopToggleBtn.querySelector('i').className = 'layui-icon layui-icon-shrink-right';
  } else {
    desktopToggleBtn.style.left = '20px';
    desktopToggleBtn.querySelector('i').className = 'layui-icon layui-icon-spread-left';
  }
}

// Set up sidebar nav item click handlers
document.querySelectorAll('.sidebar .layui-nav-item').forEach(function(item) {
  item.addEventListener('click', function(e) {
    // If in mobile mode, close the sidebar after clicking an item
    if (isMobile()) {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.remove('open');
    }
  });
});

// Sidebar toggle for mobile
document.getElementById('mobileSidebarToggle').addEventListener('click', function(e) {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('open');
  e.stopPropagation(); // Prevent event from bubbling up
});

// Sidebar toggle for desktop
document.getElementById('desktopSidebarToggle').addEventListener('click', function(e) {
  const sidebar = document.getElementById('sidebar');
  const mainContent = document.querySelector('.main-content');
  
  const isOpen = sidebar.classList.contains('open');
  
  if (isOpen) {
    // Close sidebar
    sidebar.classList.remove('open');
    mainContent.classList.remove('pushed');
    updateDesktopToggleButton(false);
  } else {
    // Open sidebar
    sidebar.classList.add('open');
    mainContent.classList.add('pushed');
    updateDesktopToggleButton(true);
  }
  
  e.stopPropagation(); // Prevent event from bubbling up
});

// Make sure clicking on the sidebar itself doesn't close it
document.getElementById('sidebar').addEventListener('click', function(e) {
  // Don't stop propagation here to allow the nav item clicks to work
  // Only stop propagation if the click is directly on the sidebar (not its children)
  if (e.target === this) {
    e.stopPropagation();
  }
});

// Close sidebar when clicking on main content (mobile only)
document.addEventListener('click', function() {
  if (isMobile()) {
    const sidebar = document.getElementById('sidebar');
    if (sidebar.classList.contains('open')) {
      sidebar.classList.remove('open');
    }
  }
});

// Initialize sidebar state and listen for window resize
window.addEventListener('resize', updateSidebarState);

// Initialize on DOM ready
document.addEventListener('DOMContentLoaded', function() {
  updateSidebarState();
  
  // For battery info, if hidden in main tab also hide in sidebar
  const updateBatteryDisplay = function() {
    if (document.getElementById('bat_li').style.display === 'none') {
      document.getElementById('bat_li_sidebar').style.display = 'none';
    }
  };
  
  // Try immediately and also after a delay to ensure it catches any dynamic changes
  updateBatteryDisplay();
  setTimeout(updateBatteryDisplay, 1000);
  
  // Make sure the sysinfo is shown first by default
  if (!location.hash || location.hash === '#tabid=66') {
    // Call sysinfo function to ensure data is loaded
    if (typeof sysinfo === 'function') {
      sysinfo();
    }
  }
});
</script>
</html>
